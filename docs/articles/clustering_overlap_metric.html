<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Clustering Overlap Metric for Determining the Optimal Number of Clusters • clav</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Clustering Overlap Metric for Determining the Optimal Number of Clusters">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">clav</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/clav.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/clustering_overlap_metric.html">Clustering Overlap Metric for Determining the Optimal Number of Clusters</a></li>
    <li><a class="dropdown-item" href="../articles/daacs.html">College Readiness Profiles</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jbryer/clav/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Clustering Overlap Metric for Determining the Optimal Number of Clusters</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jbryer/clav/blob/HEAD/vignettes/clustering_overlap_metric.Rmd" class="external-link"><code>vignettes/clustering_overlap_metric.Rmd</code></a></small>
      <div class="d-none name"><code>clustering_overlap_metric.Rmd</code></div>
    </div>

    
    
<p>Data preparation…</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">penguins</span>, package <span class="op">=</span> <span class="st">'palmerpenguins'</span><span class="op">)</span></span>
<span><span class="va">cluster_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'bill_length_mm'</span>, <span class="st">'flipper_length_mm'</span><span class="op">)</span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">[</span>,<span class="va">cluster_vars</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span> <span class="co"># Two observations with missing values</span></span></code></pre></div>
<p>Standardize our two clustering variables…</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">cluster_vars</span><span class="op">)</span>, <span class="fu">clav</span><span class="fu">::</span><span class="va"><a href="../reference/scale_this.html">scale_this</a></span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Clearly there are three clusters…</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">penguins</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, <span class="va">flipper_length_mm</span>, color <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="clustering_overlap_metric_files/figure-html/unnamed-chunk-3-1.png" width="100%"></p>
<p>What do some common metrics suggest?</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oc</span> <span class="op">&lt;-</span> <span class="fu">clav</span><span class="fu">::</span><span class="fu"><a href="../reference/fitmeasures.html">optimal_clusters</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">[</span>,<span class="va">cluster_vars</span><span class="op">]</span>, max_k <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">oc</span><span class="op">)</span></span></code></pre></div>
<p><img src="clustering_overlap_metric_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
<ul>
<li>Davies-Bouldin’s Index: 2</li>
<li>Calinski-Harabasz Statistic: 2</li>
<li>Within sum of squares: 3</li>
<li>Silhouette score: 2</li>
<li>Gap statistic: 3</li>
<li>Rand Index: 4</li>
</ul>
<p>Two of the six metric suggest the actual number of clusters of
three.</p>
<p>As describe <a href="https://jbryer.github.io/clav/articles/clav.html" class="external-link">here</a> the
cluster validation uses a bootstrap (or bootstrap like approach) to
determine if the clusters are consistent across all the samples. If one
of the goals of clustering is for the centers of each cluster to be as
far apart from one another as possible, we can use the distributions of
cluster means to compare how much they overlap across all bootstrap
samples.</p>
<p>Let’s consider the known optimal number of clusters where <em>k</em>
= 3.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">km_out</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">[</span>,<span class="va">cluster_vars</span><span class="op">]</span>, centers <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="va">km_out</span><span class="op">$</span><span class="va">cluster</span></span>
<span><span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu">clav</span><span class="fu">::</span><span class="fu"><a href="../reference/cluster_validation.html">cluster_validation</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">penguins</span><span class="op">[</span>,<span class="va">cluster_vars</span><span class="op">]</span>,</span>
<span>                               n_clusters <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                               sample_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span>,</span>
<span>                               replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                               verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span></span></code></pre></div>
<p><img src="clustering_overlap_metric_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
<p>The profile plot above shows that there is pretty good separation,
but the separation between <code>bill_length_mm</code> between clusters
B and C is the smallest. We can see better when we plot the
distributions.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cluster_validation.html">plot_distributions</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span></span></code></pre></div>
<p><img src="clustering_overlap_metric_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<p>The following table calculates the percent overlap of the
distribution of the cluster centers between each cluster for each
variable (TODO: that is a wordy sentence).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv</span><span class="op">$</span><span class="va">overlap</span></span>
<span><span class="co">#&gt;            variable C1 C2      overlap k</span></span>
<span><span class="co">#&gt; 1    bill_length_mm  A  B 7.127233e-17 3</span></span>
<span><span class="co">#&gt; 2    bill_length_mm  A  C 5.327061e-17 3</span></span>
<span><span class="co">#&gt; 3    bill_length_mm  B  C 1.058899e-01 3</span></span>
<span><span class="co">#&gt; 4 flipper_length_mm  A  B 1.202857e-11 3</span></span>
<span><span class="co">#&gt; 5 flipper_length_mm  A  C 5.878019e-17 3</span></span>
<span><span class="co">#&gt; 6 flipper_length_mm  B  C 9.607188e-04 3</span></span></code></pre></div>
<p>The following function will call <code>cluster_validation</code> and
save the cluster overlap.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#'</span></span>
<span><span class="co">#' Note: This will use bootstrapping.</span></span>
<span><span class="va">overlap_fits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>        <span class="va">df</span>,</span>
<span>        <span class="va">k</span> <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>        <span class="va">verbose</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        <span class="va">...</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="va">verbose</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Estimating for k = '</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span></span>
<span>        <span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu">clav</span><span class="fu">::</span><span class="fu"><a href="../reference/cluster_validation.html">cluster_validation</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df</span>,</span>
<span>                                       n_clusters <span class="op">=</span> <span class="va">i</span>,</span>
<span>                                       sample_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span>
<span>                                       replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                       verbose <span class="op">=</span> <span class="va">verbose</span>,</span>
<span>                                       <span class="va">...</span><span class="op">)</span></span>
<span>        <span class="va">overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">overlap</span>, <span class="va">cv</span><span class="op">$</span><span class="va">overlap</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">overlap</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now let’s try this for <em>k</em> equal to 2 through 6 clusters.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">overlap</span> <span class="op">&lt;-</span> <span class="fu">overlap_fits</span><span class="op">(</span>df <span class="op">=</span>  <span class="va">penguins</span><span class="op">[</span>,<span class="va">cluster_vars</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The figure below shows the mean (in black) and median (in blue)
overlap. The individual points correspond to the overlap for each
variable and cluster combination (colored by the variable). Couple of
observations from this plot:</p>
<ul>
<li>It suggests that <em>k</em> = 3 is the probably the best (well
technically 2 but the median difference when <em>k</em> = 3 is the
same).</li>
<li>If there is a large overlap between clusters it is with the
<code>bill_length_mm</code> variable.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">overlap_sum</span> <span class="op">&lt;-</span> <span class="va">overlap</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_overlap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">overlap</span><span class="op">)</span>,</span>
<span>                     median_overlap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">overlap</span><span class="op">)</span>,</span>
<span>                     min_overlap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">overlap</span><span class="op">)</span>,</span>
<span>                     max_overlap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">overlap</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">overlap_sum</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">k</span>, y <span class="op">=</span> <span class="va">mean_overlap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">min_overlap</span>, ymax <span class="op">=</span> <span class="va">max_overlap</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">'grey50'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_path</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_path</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">median_overlap</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">median_overlap</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'blue'</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">overlap</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">k</span>, y <span class="op">=</span> <span class="va">overlap</span>, color <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">'Overlap'</span><span class="op">)</span></span></code></pre></div>
<p><img src="clustering_overlap_metric_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jason Bryer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
